<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Agenda Médica Diaria</title>
  <link rel="stylesheet" href="https://demos.themeselection.com/sneat-bootstrap-html-admin-template/assets/vendor/css/core.css" />
  <link rel="stylesheet" href="https://demos.themeselection.com/sneat-bootstrap-html-admin-template/assets/vendor/css/theme-default.css" />
  <link rel="stylesheet" href="https://demos.themeselection.com/sneat-bootstrap-html-admin-template/assets/css/demo.css" />
  <link rel="stylesheet" href="https://demos.themeselection.com/sneat-bootstrap-html-admin-template/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />
  <style>
    .date-top-right {
      float: right;
      font-weight: bold;
      color: #3366cc;
    }

    h4,
    .card-header {
      color: #003366 !important;
    }

    .text-muted.fw-light {
      color: #6699cc !important;
    }

    body {
      color: #003366;
    }

    thead.table-light tr {
      background-color: #cce5ff;
    }

    /* Flex container for the card header */
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #horaTitulo {
      font-weight: bold;
      font-size: 1.5rem;  
      color: #3366cc;
      margin-left: 8px;
      white-space: nowrap;
    }

    /* Estilo botón Back */
    .back-button {
      background-color: transparent;
      border: none;
      color: #3366cc;
      font-weight: bold;
      font-size: 1rem;
      cursor: pointer;
      padding: 0;
      margin-right: 15px;
      display: flex;
      align-items: center;
    }

    .back-button:hover {
      text-decoration: underline;
    }

    .back-button svg {
      margin-right: 5px;
      fill: #3366cc;
    }

    .header-flex {
      display: flex;
      align-items: center;
    }
  </style>
</head>
<body>
  <div class="container-xxl flex-grow-1 container-p-y">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div class="header-flex">
        <button class="back-button" title="Volver">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M15 8a.5.5 0 0 1-.5.5H3.707l4.147 4.146a.5.5 0 0 1-.708.708l-5-5a.5.5 0 0 1 0-.708l5-5a.5.5 0 1 1 .708.708L3.707 7.5H14.5A.5.5 0 0 1 15 8z"/>
          </svg>
          Atras
        </button>
        <h4 class="fw-bold py-3 mb-0">
          <span class="text-muted fw-light">Agenda Diaria /</span> Dr. Juan Pérez
        </h4>
      </div>
      <div class="date-top-right" id="fechaActual"></div>
    </div>

    <div class="card">
      <h5 class="card-header">
        Citas Médicas del Día
        <span id="horaTitulo"></span>
      </h5>
      <div class="table-responsive text-nowrap">
        <table class="table">
          <thead class="table-light">
            <tr>
              <th>Hora</th>
              <th>Paciente</th>
              <th>Motivo</th>
              <th>Consultorio</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody class="table-border-bottom-0" id="tablaCitas">
            <tr>
              <td>08:00 - 08:30</td>
              <td>María González</td>
              <td>Control de presión arterial</td>
              <td>Consultorio 101</td>
              <td><span class="badge bg-label-success me-1">Confirmada</span></td>
            </tr>
            <tr>
              <td>08:30 - 09:00</td>
              <td>Carlos Méndez</td>
              <td>Dolor abdominal</td>
              <td>Consultorio 101</td>
              <td><span class="badge bg-label-warning me-1">Pendiente</span></td>
            </tr>
            <tr>
              <td>09:00 - 09:30</td>
              <td>Lucía Ramírez</td>
              <td>Revisión postoperatoria</td>
              <td>Consultorio 101</td>
              <td><span class="badge bg-label-info me-1">En curso</span></td>
            </tr>
            <tr>
              <td>10:00 - 10:30</td>
              <td>José Rojas</td>
              <td>Chequeo general</td>
              <td>Consultorio 101</td>
              <td><span class="badge bg-label-success me-1">Confirmada</span></td>
            </tr>
            <tr>
              <td>11:00 - 11:30</td>
              <td>Andrea Soto</td>
              <td>Control de diabetes</td>
              <td>Consultorio 101</td>
              <td><span class="badge bg-label-danger me-1">Cancelada</span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    function actualizarFechaHora() {
      const fecha = new Date();

      // Fecha para esquina superior derecha
      const opcionesFecha = {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric",
      };
      const fechaStr = fecha.toLocaleDateString("es-ES", opcionesFecha);
      document.getElementById("fechaActual").innerText = fechaStr;

      // Hora para título
      const opcionesHora = {
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
        hour12: false,
      };
      const horaStr = fecha.toLocaleTimeString("es-ES", opcionesHora);
      document.getElementById("horaTitulo").innerText = horaStr;

      // Actualizar estados según hora actual
      actualizarEstadoEnCurso(fecha);
    }

    // Cambia el estado de la cita que esté "en curso" según la hora actual
    function actualizarEstadoEnCurso(fechaActual) {
      const filas = document.querySelectorAll("#tablaCitas tr");
      filas.forEach((fila) => {
        const horaTexto = fila.cells[0].innerText.trim(); // Ejemplo: "08:00 - 08:30"
        const estadoSpan = fila.cells[4].querySelector("span.badge");

        // Parsear horas de inicio y fin
        const [inicioStr, finStr] = horaTexto.split(" - ");
        const [inicioH, inicioM] = inicioStr.split(":").map(Number);
        const [finH, finM] = finStr.split(":").map(Number);

        // Crear objetos Date con la misma fecha que fechaActual para comparación
        const inicio = new Date(fechaActual);
        inicio.setHours(inicioH, inicioM, 0, 0);
        const fin = new Date(fechaActual);
        fin.setHours(finH, finM, 0, 0);

        // Si la hora actual está dentro del rango
        if (fechaActual >= inicio && fechaActual < fin) {
          // Cambiar estado a "En curso"
          estadoSpan.innerText = "En curso";

          // Cambiar clases para que quede como bg-label-info (azul info)
          estadoSpan.className = "badge bg-label-info me-1";
        }
      });
    }

    actualizarFechaHora();
    setInterval(actualizarFechaHora, 1000);
  </script>
</body>
</html>